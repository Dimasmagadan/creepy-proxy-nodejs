var catalog = {
    autoLoadCatEntries: false,
    currentRequest: null,
    facetHasChanged: false,
    browsingMode: "scroll",
    preloadOffset: 700,
    isMoreJS: false,
    bareBones: false,
    usedAjaxUrls: [],
    catalogiwindow: catalogi(window),
    scrollEvent: function() {
        if (!catalog.autoLoadCatEntries) {
            catalogi("#loadingIndicator").ifExists(function() {
                if (catalogi("#loadingIndicator").offset()) {
                    if (catalog.bareBones) {
                        if (catalogi(".productBox.bareBones").length > 1) {
                            var e = catalog.preloadOffset + 200;
                            var t = catalog.catalogiwindow.height();
                            var a = catalog.catalogiwindow.scrollTop();
                            if (catalogi(".productBox.bareBones").length > 0) {
                                var i = catalogi(".productBox.bareBones").first().offset().top;
                                var l = t + a;
                                var o = catalog.preloadOffset + 300;
                                if (i - e <= l) {
                                    catalog.lazyLoad(true)
                                }
                            }
                        }
                    } else if (catalog.catalogiwindow.scrollTop() + catalog.catalogiwindow.height() + catalog.preloadOffset >= catalogi("#loadingIndicator").offset().top) {
                        catalog.lazyLoad()
                    }
                }
            })
        }
        catalogi("#catalogEntryGrid").ifExists(function() {
            var e = catalogi("#catalogEntryGrid").offset().top + 3 * catalogi(".productBoxContainer").height() - catalog.catalogiwindow.height();
            if (window.matchMedia("(max-width: 766px)").matches && catalogi("#backToTopContainer").offset().top >= getTop()) {
                e = getTop()
            }
            if (catalog.catalogiwindow.scrollTop() > e) {
                catalogi("#backToTopContainer:hidden").fadeIn(200)
            }
        })
    },
    toggleFacet: function(e, t, a, i) {
        if (a) {
            this.appendFacet(e, t, i)
        } else {
            this.removeFacet(e, t, i)
        }
    },
    addFacets: function(e, t) {
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    toggleColorFacet: function(e, t, a) {
        var i = getElementByEvent(a);
        var l = false;
        var o = catalogi("#facet-checkbox" + e);
        if (o.prop("checked")) {
            o.prop("checked", false);
            catalogi("#facet-color" + e).toggleClass("selected", false);
            var r = catalogi(".facet-color" + e);
            r.find("input").prop("checked", false);
            r.toggleClass("selected", false)
        } else {
            o.prop("checked", true);
            catalogi("#facet-color" + e).toggleClass("selected", true)
        }
        if (typeof i !== "undefined") {
            l = i.className.indexOf("colorName") >= 0
        }
        if (t != "HappySizeMore" || t == "HappySizeMore" && l) {
            catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
        }
    },
    toggleTileClass: function(e) {
        catalogifilter = catalogi("#available-size-filters .facetContainer-size" + e);
        catalogiinputInAvailableFilters = catalogifilter.children("#facet-size" + e);
        catalogifilterInSelection = catalogi(".facetContainer-size" + e);
        catalogiinputInSelectedFilters = catalogifilterInSelection.children("#facet-size" + e);
        if (catalogifilter.hasClass("selected")) {
            catalogiinputInAvailableFilters.prop("checked", false);
            catalogiinputInSelectedFilters.prop("checked", false);
            catalogifilter.removeClass("selected")
        } else {
            catalogiinputInAvailableFilters.prop("checked", catalogiinputInAvailableFilters.prop("checked") == true ? false : true);
            catalogiinputInSelectedFilters.prop("checked", catalogiinputInSelectedFilters.prop("checked") == true ? false : true);
            catalogifilter.toggleClass("marked")
        }
    },
    setCategoryFacet: function(e) {
        catalogi("#categoryFilterValue").val(e);
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    priceFacet: function() {
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    priceRangeFacet: function(e, t) {
        var a = catalogi("." + t).attr("name");
        var i = catalogi("." + t).val();
        catalogi(e).addClass("selected");
        var l = catalogi("#" + t + "-min");
        var o = catalogi("#" + t + "-max");
        var r = catalogi("#priceRangeFrom");
        var n = catalogi("#priceRangeTo");
        if (l.length > 0 && r.length > 0) {
            r.val(l.val())
        }
        if (o.length > 0 && n.length > 0) {
            n.val(o.val())
        }
    },
    clearPriceRange: function(e, t) {
        t = t || window.event;
        var a = catalogi(e);
        if (a.children("#onlySaleCheckbox-selected").length > 0) {
            catalogi("#onlySaleCheckbox").attr("checked", false);
            catalogi("#onlySaleCheckbox-selected").attr("checked", false)
        } else {
            var i = catalogi("#priceRangeFrom");
            var l = catalogi("#priceRangeTo");
            catalogi("#priceRangeFrom").val("");
            catalogi("#priceRangeTo").val("")
        }
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    appendFacet: function(e, t) {
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    removeFacet: function(e, t, a) {
        if (typeof a === "undefined") {
            a = true
        }
        catalogi("#available-" + e + "-filters .facetContainer-" + e + t).parent().removeClass("selected");
        catalogi(".selected-" + e + "-filters .facetContainer-" + e + t).remove();
        catalogi("#available-" + e + "-filters #facet-" + e + t).prop("checked", false);
        if (a) {
            catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
        }
    },
    removeFacetHappySizeMore: function(e, t, a) {
        var i = catalogi(getElementByEvent(a));
        var l = i.parent().parent().hasClass("selectedFilterContainer");
        var o = i.parent().parent();
        if (l) {
            catalogi("#available-" + e + "-filters .facetContainer-" + e + t).parent().removeClass("selected");
            catalogi(".selected-" + e + "-filters .facetContainer-" + e + t).remove();
            catalogi("#available-" + e + "-filters #facet-" + e + t).prop("checked", false);
            catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
        } else if (catalogi("html").hasClass("lt-ie9")) {
            this.toggleTileClass(t)
        }
    },
    clearFilter: function(e) {
        if (!catalogi("#available-" + e + "-filters input:checked").length) return;
        catalogi("#available-" + e + "-filters input").prop("checked", false);
        catalogi(".selected-" + e + "-filters").html("");
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    clearColorFilter: function(e) {
        if (!catalogi("#available-color-filters input:checked").length) return;
        catalogi("#available-color-filters input").prop("checked", false);
        catalogi("#available-color-filters .color").toggleClass("selected", false);
        catalogi(".selected-color-filters input").prop("checked", false);
        catalogi(".selected-color-filters .color").toggleClass("selected", false);
        if (e) catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    clearCategoryFilter: function() {
        catalogi("#categoryFilterValue").val("");
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    clearAllFilters: function() {
        this.clearAllFiltersOnly();
        catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.facetChanged")
    },
    clearAllFiltersOnly: function() {
        this.clearColorFilter(false);
        catalogi(".selectedFiltersContainer").html("");
        catalogi(".facetCheckbox").prop("checked", false);
        catalogi("#priceRangeFrom").val(priceFilterMinDefault);
        catalogi("#priceRangeTo").val(priceFilterMaxDefault);
        catalogi("#priceFilterContainer input").each(function() {
            if (catalogi(this).is(":radio") || catalogi(this).is(":checkbox")) {
                catalogi(this).removeAttr("checked")
            }
        })
    },
    updateFilters: function() {
        for (i = 0; i < facetIDs.length; i++) {
            if (facetIDs[i] === "color") {
                var e = catalogi("#available-" + facetIDs[i] + "-filters input:checked").parent().parent().parent().clone();
                e.find("input").attr("name", "");
                e.appendTo(".selected-" + facetIDs[i] + "-filters")
            } else {
                var t = catalogi("#available-" + facetIDs[i] + "-filters input:checked");
                var a = catalogi(".selected-" + facetIDs[i] + "-filters");
                catalogiclone = t.parent().clone();
                catalogiclone.find("input").attr("name", "");
                a.html(catalogiclone);
                if ((t.is(":radio") || t.is(":checkbox")) && facetIDs[i] === "price") {
                    a.children("div").addClass("selected");
                    a.children("div").attr("onclick", "catalog.clearPriceRange(this, event);");
                    a.children().children("label").each(function() {
                        catalogi(this).attr("for", catalogi(this).attr("for") + "-selected")
                    });
                    a.children().children("input").each(function() {
                        var e = catalogi(this).attr("id");
                        var t = catalogi(this).attr("name");
                        if (e !== undefined) {
                            catalogi(this).attr("id", catalogi(this).attr("id") + "-selected")
                        }
                        if (t !== undefined && t !== "") {
                            catalogi(this).attr("name", catalogi(this).attr("name") + "-selected")
                        } else {
                            catalogi(this).attr("name", catalogi(this).attr("id"))
                        }
                    });
                    if (t.is(":radio")) {
                        t.attr("checked", "true")
                    }
                }
            }
        }
    },
    facetChanged: function() {
        if (typeof catalog.currentRequest !== "undefined" && catalog.currentRequest) {
            catalog.currentRequest.abort()
        }
        catalogAjaxURL = null;
        catalogi("#catalogEntryGrid").html("");
        showLoadIndicator();
        catalog.checkFacetLabels();
        catalogi("#categoryFacetForm").submit()
    },
    checkFacetLabels: function() {
        filterActive = false;
        for (i = 0; i < facetIDs.length; i++) {
            selectedFilters = catalogi(".selected-" + facetIDs[i] + "-filters");
            if (selectedFilters.length && selectedFilters.html().length) {
                filterActive = true;
                catalogi("#" + facetIDs[i] + "-filter-label").show()
            } else {
                catalogi("#" + facetIDs[i] + "-filter-label").hide()
            }
        }
        if (filterActive) {
            catalogi("#allSelectedFiltersHeader").show()
        } else {
            catalogi("#allSelectedFiltersHeader").hide()
        }
        catalogi(".filterContainer").each(function(e, t) {
            if (catalogi(t).children(".selectedFiltersContainer").find("div").length >= 1) {
                catalogi(t).find(".selectedFilterLabel").show()
            } else {
                catalogi(t).find(".selectedFilterLabel").hide()
            }
        })
    },
    lazyLoad: function(e) {
        var e = e ? e : false;
        if (!catalogi.active) {
            if (typeof catalogAjaxURL !== "undefined" && catalogAjaxURL) {
                if (e) {
                    var t = this.getPreparedCatalogAjaxUrl(catalogAjaxURL);
                    if (catalog.usedAjaxUrls.indexOf(t) < 0) {
                        this.loadCategoryEntries(t, true)
                    }
                } else {
                    var t = this.getPreparedCatalogAjaxUrl(catalogAjaxURL);
                    if (catalog.browsingMode === "scroll") {
                        catalogi("#footer").css("visibility", "hidden");
                        catalogi("#historyRecoTop").css("visibility", "hidden")
                    }
                    this.loadCategory(t, true)
                }
            } else {
                hideLoadIndicator("catalogLoadingIndicator");
                catalogi("#footer").css("visibility", "visible");
                catalogi("#historyRecoTop").css("visibility", "visible");
                updateBackToTop()
            }
        }
    },
    imgLazyLoad: function() {
        catalogi("img.lazyLoad").lazyload({
            threshold: 150,
            effect: "fadeIn"
        })
    },
    getPreparedCatalogAjaxUrl: function(e) {
        var t = new Url(e);
        if (typeof t.query.initPageSize !== "undefined") {
            t.query.beginIndex = t.query.pageSize;
            t.query.pageSize = t.query.initPageSize
        }
        return t.toString()
    },
    loadCategory: function(e, t) {
        if (typeof this.currentRequest != "undefined" && this.currentRequest) {
            this.currentRequest.abort()
        }
        e = stripProtocol(e);
        if (!t && catalog.browsingMode == "scroll") {
            catalogi("#catalogEntryGrid").html("");
            showLoadIndicator("catalogLoadingIndicator")
        }
        this.currentRequest = catalogi.post(e, function(e) {
            catalogi(e).appendTo("#catalogEntryGrid");
            catalog.imgLazyLoad();
            if (checkDevice.isMobile()) {
                catalog.applyTouchFunctions()
            }
            if (this.autoLoadCatEntries) {
                this.lazyLoad()
            } else {
                catalog.catalogiwindow.scroll();
                updateBackToTop()
            }
            catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.loaded");
            hideLoadIndicator("catalogLoadingIndicator")
        }).always(function() {
            if (catalog.isMoreJS && typeof MoreJS.showMoreColors == "function") {
                MoreJS.showMoreColors()
            }
        })
    },
    loadCategoryEntries: function(e, t) {
        if (typeof this.currentRequest != "undefined" && this.currentRequest) {
            this.currentRequest.abort()
        }
        e = stripProtocol(e);
        this.currentRequest = catalogi.post(e, function(t) {
            catalog.usedAjaxUrls.push(e);
            var a = catalogi(t);
            a.each(function() {
                var e = catalogi(this);
                if (e.hasClass("productBoxContainer")) {
                    var t = e.prop("id");
                    if (typeof t !== "undefined") {
                        catalogi("#" + t).empty().append(e.html())
                    }
                } else if (e.attr("id") === "CatalogAjaxURL") {
                    var a = e.data("url");
                    if (catalog.usedAjaxUrls.indexOf(a) < 0) {
                        catalogAjaxURL = a
                    }
                } else if (e.prop("tagName") === "SCRIPT") {
                    e.appendTo(catalogi("body"))
                }
            });
            catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.loaded");
            catalog.imgLazyLoad()
        }).always(function() {
            if (catalog.isMoreJS && typeof MoreJS.showMoreColors == "function") {
                MoreJS.showMoreColors()
            }
        })
    },
    loadMoreCategoryEntries: function() {
        showLoadIndicator("catalogLoadingIndicator");
        catalogi(".loadMoreCatEntriesContainer").addClass("hideBanner");
        catalog.lazyLoad()
    },
    filterSlideToggle: function(e) {
        e.prev().children(".filterHeader").toggleClass("closed");
        e.toggleClass("closed")
    },
    toggleStandardFilter: function() {
        if (catalogi("#additionalFilterContainer").hasClass("closed")) {
            catalogi(".allAdditionalFiltersToggle .lessFilterLabel").css("display", "none");
            catalogi(".allAdditionalFiltersToggle .moreFiltersLabel").css("display", "block");
            docCookies.setItem("filterCookieMore", 0)
        } else {
            catalogi(".allAdditionalFiltersToggle .lessFilterLabel").css("display", "block");
            catalogi(".allAdditionalFiltersToggle .moreFiltersLabel").css("display", "none");
            docCookies.setItem("filterCookieMore", 1)
        }
        if (window.matchMedia("(max-width: 1023px)").matches) {
            catalogi("#categoryFacetForm > .filterHeaderContainer").toggleClass("show");
            if (catalogi("#categoryFacetForm > .filterHeaderContainer")[0] != null) {
                catalogi(catalogi("#categoryFacetForm > .filterHeaderContainer")[0]).addClass("firstFilter")
            }
        }
    },
    hoverColor: function(e, t) {
        var a = catalogi("#productSizes-" + e);
        var i = catalogi("#productBox-" + e);
        i.addClass("hasHover");
        i.find(".categoryAvailabilityHover, .categoryProductAttributeContainer").off("mouseleave").on("mouseleave", function() {
            i.removeClass("hasHover");
            i.find(".categoryAvailabilityHover,  .categoryProductColors").off("mouseleave")
        });
        if (a.data("color") === t) {
            return
        } else {
            catalogi("#productSizes-" + e).html('<div class="loadingIndicator"><img src="' + kmo_wcs_pbcatalogi.getImgDir() + 'ajax-loader.gif" alt="' + labels.loadingIconAlt + '"></div>');
            var l = {};
            l.storeId = kmo_wcs_pbcatalogi.getStoreId();
            l.langId = kmo_wcs_pbcatalogi.getLangId();
            l.catalogId = kmo_wcs_pbcatalogi.getCatalogId();
            l.productId = e;
            l.colorId = t;
            if (typeof kmo_wcs_pbcatalogi.getCategoryId != "undefined") {
                l.categoryId = kmo_wcs_pbcatalogi.getCategoryId()
            }
            l.onlyCatalogEntryPrice = "true";
            catalogi.post("AjaxProductSizes", l, function(e) {
                a.html(e);
                a.data("color", t);
                a.parents(".categoryAvailabilityHover").hide().show(0);
                a.parents(".categoryAvailabilityHover").attr("style", "")
            })
        }
    },
    toggleColorBlock: function(e) {
        catalogi(e).parents(".categoryProductAttributeContainer").children(".categoryProductColors").removeClass("colorsOverflow");
        catalogi(e).parents(".linkForColorOverflow").hide()
    },
    togglefilterexpanded: function(e) {
        var t = catalogi("#additional-" + e);
        t.toggle();
        if (t.parent().find(".expand").hasClass("not")) {
            t.parent().find(".unexpand").addClass("not");
            t.parent().find(".expand").removeClass("not")
        } else if (t.parent().find(".unexpand").hasClass("not")) {
            t.parent().find(".expand").addClass("not");
            t.parent().find(".unexpand").removeClass("not")
        }
    },
    initializeSlider: function(e) {
        if (typeof e === "undefined") {
            e = "#priceFilterContainer"
        }
        var t = catalogi(e);
        if (!t.find("#priceFilter").length) {
            return
        }
        var a = t.find(".priceRangeFrom");
        var i = t.find(".priceRangeTo");
        var l = a.val();
        if (!(l && l != "*")) l = priceFilterMinDefault;
        var o = i.val();
        if (!(o && o != "*")) o = priceFilterMaxDefault;
        return t.children(".slider").noUiSlider({
            range: [priceFilterMinDefault, priceFilterMaxDefault],
            start: [l, o],
            connect: true,
            serialization: {
                to: [a, i],
                resolution: 1,
                mark: ","
            }
        })
    },
    orderBy: function(e, t) {
        catalogi("#" + e + " [name='orderBy']").val(t);
        catalog.facetChanged()
    },
    synchronizeCatalogEspots: function() {
        catalogi(".catalogListingESpot").each(function() {
            var e = catalogi(this);
            catalogi("#placeForEspotOnCategoryPage_" + e.data("index")).appendTo(e)
        })
    },
    applyTouchFunctions: function() {
        catalogi("#catalogEntryGrid").find(".quickViewLink").css("display", "none");
        catalogi(".productBoxImage").off("touchend").on("touchend", function() {
            catalogi(this).children(".catEntryDisplayLink").trigger("click")
        })
    },
    defineEvents: function() {
        var e = "";
        var t = catalogi("#categoryFacetForm");
        catalogilinks = t.find("a[data-click]");
        catalogilinks.each(function() {
            var t = catalogi(this);
            t.click(function(a) {
                var i = t.attr("data-click").split(";");
                for (var l = 0; l < i.length; l++) {
                    var o = catalogi.trim(i[l]);
                    if (o.length > 0) {
                        e = i[l];
                        var r = new Function(e);
                        try {
                            r()
                        } catch (n) {
                            if (window.console) {
                                console.log(n)
                            }
                        }
                    }
                }
            })
        })
    }
};

function initializeCategoryPage() {
    catalog.isMoreJS = typeof MoreJS != "undefined";
    catalog.bareBones = function() {
        if (typeof kmo_wcs_pbcatalogi.getBareBones !== "undefined" && kmo_wcs_pbcatalogi.getBareBones() === true) {
            return true
        } else {
            return false
        }
    }();
    if (catalog.isMoreJS) {
        catalog.browsingMode = "click";
        hideLoadIndicator("catalogLoadingIndicator")
    }
    if (catalogi(".productBox").length && catalog.browsingMode == "scroll") {
        if (!catalog.bareBones) {
            catalogi("#footer").css("visibility", "hidden");
            catalogi("#historyRecoTop").css("visibility", "hidden")
        } else {
            hideLoadIndicator("catalogLoadingIndicator")
        }
    }
    catalog.initializeSlider();
    if (catalog.browsingMode == "scroll") {
        catalog.catalogiwindow.scroll(function() {
            catalog.scrollEvent();
            updateBackToTop()
        })
    } else {
        catalog.catalogiwindow.scroll(updateBackToTop)
    }
    if (checkDevice.isMobile()) {
        catalog.applyTouchFunctions()
    }
    catalog.catalogiwindow.resize(updateBackToTop, "resize", 100);
    catalog.imgLazyLoad();
    catalogi("#available-color-filters .colorTile").bind({
        mouseleave: function() {
            catalogi("#color-filter-preview").html("")
        },
        mouseenter: function() {
            catalogi(this).clone().appendTo("#color-filter-preview");
            catalogi("#color-filter-preview").append(catalogi(this).children(".color").attr("title"))
        }
    });
    if (catalog.autoLoadCatEntries) {
        catalog.lazyLoad()
    } else {
        catalog.catalogiwindow.scroll()
    }
    catalog.updateFilters();
    if (catalogi("#allSelectedFilters .selectedFilterContainer").children().length) {
        catalogi("#allSelectedFiltersHeader").show()
    } else {
        catalogi("#allSelectedFiltersHeader").hide()
    }
    catalog.checkFacetLabels();
    catalogi("#mainContent").on("appear", "img.lazyLoad", function() {
        catalogi(this).removeClass("lazyLoad")
    });
    if (!catalog.isMoreJS && kmo_wcs_pbcatalogi.getFilterLayout() !== "MobileLight" && catalogi(".catalogSection .categoryGridHeaderContainer").length > 0) {
        catalogi("body").off("click", ".sideNavFilterContainer  .filterInputContainer").on("click", ".sideNavFilterContainer .filterInputContainer", function() {
            catalogi("html, body").animate({
                scrollTop: catalogi(".catalogSection .categoryGridHeaderContainer").offset().top + "px"
            }, 500)
        });
        catalog.scrollEvent()
    }
    if (catalogi("#additionalFilterContainer").length > 0) {
        catalogi("#additionalFilterContainer").find(".filterContainer").each(function() {
            catalogi(this).addClass("closed")
        })
    }
    var e = catalogi("#priceFilterContainer");
    if (e.length > 0) {
        var t = catalogi("#priceRangeFrom");
        var a = catalogi("#priceRangeTo");
        if (t.length > 0) {
            t.bind("keyup", function() {
                MoreJS.toggleFilterBtn("#" + e.attr("id"))
            })
        }
        if (a.length > 0) {
            a.bind("keyup", function() {
                MoreJS.toggleFilterBtn("#" + e.attr("id"))
            })
        }
    }
    catalog.defineEvents();
    catalog.synchronizeCatalogEspots();
    catalogi(kmo_wcs_pbcatalogi.eventBus).on("catalog.loaded", catalog.synchronizeCatalogEspots);
    catalogi(kmo_wcs_pbcatalogi.eventBus).on("catalog.facetChanged", catalog.facetChanged);
    catalogi(kmo_wcs_pbcatalogi.eventBus).trigger("catalog.initialized")
}
initializeCategoryPage();
